# 環境変数オプション追加機能の実装計画

## 実装タスクリスト

### 1. 環境変数パーサーユーティリティの作成
- [ ] `src/utils/envParser.ts`を新規作成
- [ ] `parseEnvVars`関数を実装
  - [ ] 基本的なKEY=VALUE形式のパース
  - [ ] 値に`=`が含まれる場合の対応
  - [ ] エラーハンドリング（不正な形式の検知）
- [ ] 単体テスト`test/utils/envParser.test.ts`を作成

### 2. エディタモジュールの改修
- [ ] `src/modules/editor.ts`の改修
  - [ ] `launchEditor`関数に環境変数パラメータを追加
  - [ ] `spawn`の`env`オプションで環境変数を設定
  - [ ] `EDITPROMPT=1`を常に付与する処理を追加
  - [ ] `openEditorAndGetContent`関数に環境変数パラメータを追加
  - [ ] 環境変数パーサーの呼び出しを追加

### 3. CLIインターフェースの拡張
- [ ] `src/index.ts`の改修
  - [ ] `env`オプションを`args`に追加（short: "E", multiple: true）
  - [ ] `openEditorAndGetContent`の呼び出しに環境変数を渡す

### 4. テストの実装
- [ ] 環境変数パーサーの単体テスト
  - [ ] 正常系：単一の環境変数
  - [ ] 正常系：複数の環境変数
  - [ ] 正常系：値に`=`を含む環境変数
  - [ ] 異常系：`=`がない形式
  - [ ] 異常系：キーが空の形式
- [ ] 統合テストの作成または既存テストの更新
  - [ ] 環境変数が正しく設定されることの確認
  - [ ] `EDITPROMPT=1`が常に設定されることの確認

### 5. ドキュメントの更新
- [ ] READMEに`--env`オプションの使用例を追加
- [ ] `CLAUDE.md`に新機能の説明を追加（必要に応じて）

## 実装順序

1. **環境変数パーサーの実装とテスト**
   - 独立したユーティリティなので最初に実装
   - テストで動作を確認してから次に進む

2. **エディタモジュールの改修**
   - コア機能の改修
   - 環境変数の設定が正しく動作することを確認

3. **CLIインターフェースの拡張**
   - ユーザーインターフェースの追加
   - エンドツーエンドで動作確認

4. **テストとドキュメント**
   - 全体の動作を保証
   - ユーザー向けドキュメントの更新

## 動作確認項目

1. `editprompt --env FOO=bar`で環境変数が設定されること
2. `editprompt --env A=a --env B=b`で複数の環境変数が設定されること
3. エディタ内で`echo $EDITPROMPT`が`1`を返すこと
4. 既存の機能（`--editor`、`--process`等）が正常に動作すること

## 注意事項

- 既存のテストが失敗しないことを確認する
- 型チェック（`bun run build`）でエラーが出ないことを確認する
- Biomeでのフォーマット/リントエラーがないことを確認する